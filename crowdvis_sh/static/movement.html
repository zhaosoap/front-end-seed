<html>
<head>
    <title>Contact Vis</title>
    <script src="lib/leaflet.js"></script>
    <script src="lib/jquery.min.js"></script>
    <script src="lib/bootstrap.min.js"></script>
    <script src="lib/queue.v1.min.js"></script>
    <script src="lib/d3.v3.min.js"></script>
    <script src="lib/dhtmlxslider.js"></script>
    <script src='lib/mapbox.js'></script>
    <script src='lib/jquery-ui.min.js'></script>
    <script src='lib/jquery.ui.timepicker.js'></script>

    <link rel='stylesheet' href='https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.css' />
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap-theme.min.css" />
    <link rel="stylesheet" href="lib/jquery-ui.min.css" />
    <link rel="stylesheet" href="lib/jquery-ui.theme.min.css" />
    <link rel="stylesheet" href="lib/jquery-ui.structure.min.css" />
    <link rel="stylesheet" href="lib/jquery.ui.timepicker.css" />
    
    <link rel="stylesheet" type="text/css" href="lib/dhtmlxslider.css" />
    <link rel="stylesheet" type="text/css" href="style/movement/basic.css" />
    <link rel="stylesheet" type="text/css" href="style/movement/widgets.css" />
    <link rel="stylesheet" type="text/css" href="style/movement/control.css" />
    <link rel="stylesheet" href="lib/draw/dist/leaflet.draw.css" />

    <script src="js/movement/leaflet-heat.js"></script>
    <script src="js/movement/data-reader.js"></script>
    <script src="js/movement/grid-view.js"></script>
    <script src="js/movement/heatmap-container.js"></script>
	<script src="js/movement/selection-window.js"></script>

    <script src="lib/draw/Leaflet.draw.js"></script>

    <script src="lib/draw/edit/handler/Edit.Poly.js"></script>
    <script src="lib/draw/edit/handler/Edit.SimpleShape.js"></script>
    <script src="lib/draw/edit/handler/Edit.Circle.js"></script>
    <script src="lib/draw/edit/handler/Edit.Rectangle.js"></script>

    <script src="lib/draw/draw/handler/Draw.Feature.js"></script>
    <script src="lib/draw/draw/handler/Draw.Polyline.js"></script>
    <script src="lib/draw/draw/handler/Draw.Polygon.js"></script>
    <script src="lib/draw/draw/handler/Draw.SimpleShape.js"></script>
    <script src="lib/draw/draw/handler/Draw.Rectangle.js"></script>
    <script src="lib/draw/draw/handler/Draw.Circle.js"></script>
    <script src="lib/draw/draw/handler/Draw.Marker.js"></script>

    <script src="lib/draw/ext/LatLngUtil.js"></script>
    <script src="lib/draw/ext/GeometryUtil.js"></script>
    <script src="lib/draw/ext/LineUtil.Intersect.js"></script>
    <script src="lib/draw/ext/Polyline.Intersect.js"></script>
    <script src="lib/draw/ext/Polygon.Intersect.js"></script>

    <script src="lib/draw/Control.Draw.js"></script>
    <script src="lib/draw/Tooltip.js"></script>
    <script src="lib/draw/Toolbar.js"></script>

    <script src="lib/draw/draw/DrawToolbar.js"></script>
    <script src="lib/draw/edit/EditToolbar.js"></script>
    <script src="lib/draw/edit/handler/EditToolbar.Edit.js"></script>
    <script src="lib/draw/edit/handler/EditToolbar.Delete.js"></script>

</head>

<body onload="doOnLoad();">
<!-- NAVBAR
        ================================================== -->
<div class="navrow" style="height:40px; width:100%">
        <div id="title_icon"><img src="images/crowdvis_w.png">
        </div><div class="navbar_wrapper">
            <a href="index.html"><span>Home</span>
            </a><a href="density.html"><span>Density</span>
            </a><a class="active"><span>Movement</span>
            </a>
        </div>
</div>
<div id="cover_on_top">
	<div class="panel panel-default" id="select_panel">
		<div class="panel-heading">Source Selection
			<span class="glyphicon glyphicon-remove-sign" id="exit_sign" aria-hidden="true"></span>
		</div>
		<div class="map panel-body" id="map_on_top">
        </div>
        <div id="display_column">
            <div id="region_list" class="select_info_display"></div>
        </div>
		<div id="region_submit_btn">Submit</div>
	</div>
</div>


	
<div id="loader_page">
	<div id="loader_gif_row">
		<img src="images/loader-search-blue.gif" />
	</div>
	<div id="loader_text">
		<span></span>
	</div>
</div>
	
<div id="main">
    <div class="panel panel-default" id="control_panel">
        <div class="panel-heading">Controller</div>
        <div id="control_body">
            <ul class="list-group nomargin">
                <li class="list-group-item nomargin">
                    <div class="title_large">Heatmap Controller</div>
                    <div class="row">
                        <div class="col-md-1 nomargin smallpadding">
                            <span class="glyphicon glyphicon-fire" aria-hidden="true" style="left:15px;"></span>
                        </div>
                        <div class="col-md-4 nomargin smallpadding">Heat Level <span style="position:absolute;right:0;">High</span></div>
                        <div class="col-md-5 nomargin smallpadding">
                            <div id="slider_percentile" class="slider"></div>
                        </div>
                        <div class="col-md-2 nomargin smallpadding">
                            <span style="position:absolute;left:0;">Low</span>
                        </div>
                    </div>
                </li>
                <li class="list-group-item nomargin">
                    <div class="title_large">Sources Selected:</div>
                    <div class="row" style="padding-left:20px;padding-right:20px;">
                        <div class="col-md-12 nomargin point_selected_display" id="point_select_btn">
                            <span>Click to select a point<br /></span>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>

    <div class="panel panel-default" id="map_contact_panel">
        <div class="panel-heading">Movement Heatmap</div>
        <div class="map panel-body" id="map_contact"></div>
        <div id="slide_container">
            <div class="arrow" id="left_arrow" style="left:0;background-image: url(images/left.png)"></div>
            <div class="arrow" id="right_arrow" style="right:0;background-image: url(images/right.png)"></div>
        </div>
        <div id="grid_view_window">
            <div id="grid_view_panel"></div>
        </div>
    </div>

</div>
<script type="text/javascript">
    // Initialize parameters and objects
    var colorScale = ["#F9FF40","#FFE240","#FFAF40","#FF7040","#FF4040","#FF0000"];
	var centerIcon = L.icon({
	    iconUrl: 'images/markers/marker.png',
	
	    iconSize:     [20, 34], // size of the icon
	    iconAnchor:   [10, 34] // point of the icon which will correspond to marker's location
	});
    var defaultFullHeat = 60, fullHeat = 60;
    var residenceMap = new HeatmapContainer("map_contact");
    var time_select = null;

    residenceMap.initMap();
    residenceHeat = new HeatLayerContainer(residenceMap);
    residenceHeat.heatmapOptions.radius = 14;
    residenceHeat.heatmapOptions.blur = 14;
    residenceHeat.heatmapOptions.density = 0.4;

    resetSize();
	initSelectionWindow();
    timeSlider = null;
	
    function doOnLoad(){
        setSliders();
   	
	   	$("*").attr('unselectable','on')
	     .css({'-moz-user-select':'-moz-none',
	           '-moz-user-select':'none',
	           '-o-user-select':'none',
	           '-khtml-user-select':'none', /* you could also put this in a class */
	           '-webkit-user-select':'none',/* and add the CSS class here instead */
	           '-ms-user-select':'none',
	           'user-select':'none'
	     }).bind('selectstart', function(){ return false; });
    }

    function setSliders(){
        var slider_percentile = new dhtmlXSlider({
            parent:     "slider_percentile",
            value:      defaultFullHeat,
            step:       defaultFullHeat/20,
            min:        1,
            max:        15*defaultFullHeat,
            vertical:   false,
            skin:		"dhx_skyblue"
        });

        slider_percentile.attachEvent("onChange", function(value){
            residenceHeat.updateHeatlevel(value/fullHeat);
            residenceHeat.drawHeatmap(residenceHeat.heat_data);
            
            fullHeat = value;
            d3.selectAll(".cell").style("fill",function(d){
                if (d.v == 0)
                    return "#1B1C1C";
                else
                    return colorScale[Math.min(Math.floor(3*d.v/fullHeat),colorScale.length-1)];
            });
        });
    }

    function resetSize(){
        w_width = $("body").width();
        w_height = $("body").height();
        small_map_width = $("#map_flow_a").width();
        $("#map_on_top").height(w_height*0.6-35);
        $("#station_list_display").height(w_height*0.6-35);
    }

    $(".arrow").click(function(e){
        var index = $(this).index(".arrow");
        if (index == 0)
        {
            timeSlider.shiftBar(false);
        }
        else
        {
            timeSlider.shiftBar(true);
        }
    });
    
    $(document).ready(function(){
    	time_select = $('#time_select');
    	
        time_select.timepicker({
		    showPeriod: true,
		    showLeadingZero: true,
		    closeButtonText: 'Done',
		    showCloseButton: true,
		    defaultTime: '08:00'
		});
    });
    

</script>
</body>
</html>